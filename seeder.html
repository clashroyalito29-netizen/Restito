<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Carga de Datos de Prueba</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .log-box {
            background: #000;
            color: #0f0;
            font-family: monospace;
            padding: 15px;
            border-radius: 8px;
            height: 300px;
            overflow-y: auto;
            margin-top: 20px;
            border: 1px solid #333;
        }
    </style>
</head>
<body>
    <div class="container" style="max-width: 600px; margin: 50px auto; text-align: center;">
        <div class="glass-card">
            <h2>üçî Carga de Men√∫ Inicial</h2>
            <p>Este script borrar√° los datos actuales (si existen) y crear√° un men√∫ demo profesional.</p>
            <button onclick="runSeed()" class="btn-primary" id="btn-seed">
                üöÄ Inyectar Datos de Prueba
            </button>
        </div>

        <div id="console" class="log-box">Esperando comando...</div>
    </div>

    <script type="module">
        import { supabase } from './supabase-client.js';

        const log = (msg) => {
            const c = document.getElementById('console');
            c.innerHTML += `> ${msg}<br>`;
            c.scrollTop = c.scrollHeight;
        };

        window.runSeed = async () => {
            const btn = document.getElementById('btn-seed');
            btn.disabled = true;
            btn.innerText = "Procesando...";
            
            try {
                log("Iniciando limpieza de base de datos...");
                
                // 1. Limpiar datos existentes (Orden inverso por claves for√°neas)
                await supabase.from('pedidos').delete().neq('id', 0);
                await supabase.from('productos').delete().neq('id', 0);
                await supabase.from('categorias').delete().neq('id', 0);
                
                log("‚úÖ Base de datos limpia.");

                // 2. Crear Categor√≠as
                log("Creando categor√≠as...");
                const { data: cats, error: catError } = await supabase.from('categorias').insert([
                    { nombre: 'Hamburguesas', orden: 1 },
                    { nombre: 'Acompa√±amientos', orden: 2 },
                    { nombre: 'Bebidas', orden: 3 },
                    { nombre: 'Postres', orden: 4 }
                ]).select();

                if (catError) throw catError;

                // Mapear IDs (porque Supabase genera IDs nuevos)
                const catMap = {};
                cats.forEach(c => catMap[c.nombre] = c.id);
                log(`‚úÖ ${cats.length} Categor√≠as creadas.`);

                // 3. Crear Productos
                log("Creando productos...");
                const productos = [
                    // Hamburguesas
                    {
                        nombre: "Doble Bacon Cheese",
                        descripcion: "Doble carne smasheada, cheddar fundido, panceta crujiente y salsa de la casa.",
                        precio: 8500,
                        categoria_id: catMap['Hamburguesas'],
                        recomendado: true,
                        stock: 50
                    },
                    {
                        nombre: "Royal Deluxe",
                        descripcion: "Carne 180g, lechuga, tomate, cebolla morada y pepinillos.",
                        precio: 7200,
                        categoria_id: catMap['Hamburguesas'],
                        recomendado: false,
                        stock: 50
                    },
                    // Acompa√±amientos
                    {
                        nombre: "Papas R√∫sticas",
                        descripcion: "Papas con piel fritas a la perfecci√≥n con dip de ajo.",
                        precio: 4500,
                        categoria_id: catMap['Acompa√±amientos'],
                        recomendado: true,
                        stock: 100
                    },
                    {
                        nombre: "Aros de Cebolla",
                        descripcion: "Crujientes aros rebozados en cerveza.",
                        precio: 3800,
                        categoria_id: catMap['Acompa√±amientos'],
                        recomendado: false,
                        stock: 80
                    },
                    // Bebidas
                    {
                        nombre: "Coca-Cola 500ml",
                        descripcion: "Bien fr√≠a.",
                        precio: 2500,
                        categoria_id: catMap['Bebidas'],
                        recomendado: false,
                        stock: 200
                    },
                    {
                        nombre: "Cerveza Artesanal IPA",
                        descripcion: "Pinta de cerveza tirada local.",
                        precio: 5000,
                        categoria_id: catMap['Bebidas'],
                        recomendado: true,
                        stock: 40
                    }
                ];

                const { error: prodError } = await supabase.from('productos').insert(productos);
                if (prodError) throw prodError;

                log("‚úÖ Productos creados exitosamente.");
                log("üéâ ¬°PROCESO TERMINADO! Ya puedes abrir el men√∫.");
                
                btn.style.backgroundColor = "var(--success)";
                btn.innerText = "¬°Datos Cargados!";

            } catch (error) {
                console.error(error);
                log(`‚ùå ERROR: ${error.message}`);
                btn.disabled = false;
                btn.innerText = "Reintentar";
            }
        };
    </script>
</body>
</html>

